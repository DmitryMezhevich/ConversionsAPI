<!--
    Функции помощники:
        Отправка ивентов на сервер
        Функция для форматирования номера клиента под ивенты TikTok
        Отправка заказа в telegram
        Попытка отправки заказа еще раз при не удачном первом разе
        Открыть и закрыть popUp
-->

<script>
    function sendEvent(url, data) {
        axios.post(url, data, {
            headers: {
                'Content-Type': 'application/json',
            },
        });
    }

    function formatPhoneNumber(phoneNumber) {
        if (!phoneNumber) { return null }

        phoneNumber = phoneNumber.replace(/\D/g, '');

        if (phoneNumber.length >= 9) {
            let firstChars = phoneNumber.slice(0, -7);
            const lastSevnChars = phoneNumber.slice(-7);

            if (firstChars.includes('25')) {
                firstChars = '+37525';
            }
            if (firstChars.includes('33')) {
                firstChars = '+37533';
            } else if (firstChars.includes('44')) {
                firstChars = '+37544';
            } else firstChars = '+37529';

            return `${firstChars}${lastSevnChars}`;
        } else {
            return null;
        }
    }

    function sendOrder(loadingPopUp = false) {
        if (loadingPopUp) { openPopUp('loading') }

        axios
            .post(URI_API, {
                chat_id: CHAT_ID,
                parse_mode: 'html',
                text: message,
            })
            .then(() => {
                closePopUp();
                window.location.href = srcThenksPage;
            })
            .catch(() => {
                closePopUp();
                openPopUp('error');
            });
    }

    function addListenerResendOrder() {
        const button = document.querySelector('#rec747446791 button');
        button.addEventListener('click', function () {
            sendOrder(true);
        });
    }

    function openPopUp(name) {
        var linkToPopup = document.createElement('a');
        linkToPopup.setAttribute('href', `${window.location.hash}#${name}`);
        linkToPopup.style.display = 'none';
        document.querySelector('.r').appendChild(linkToPopup);
    
        t_onReady (function () {
            t_onFuncLoad('t_popup__showPopup', function () {
                linkToPopup.click();
            });
        });
    }
    
    function closePopUp() {
        const popUpOpn = document.querySelector('.t-popup_show');
        console.log(popUpOpn);
        popUpOpn.click();
    }
</script>