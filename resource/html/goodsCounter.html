<script>
    let firstGoodsCountElement = '';
    let secondGoodsCountElement = '';
    let firstTotalPay = '';
    let secondTotalPay = '';

    function setDate() {
        const date = getDateStr(2);
        const content = `
                            <span style="font-size: 16px; font-weight: 700;">
                            Акция действует с <span style="color: #e62e04">
                            ${date.old}</span><br> по <span style="color:
                            #e62e04">${date.new}</span> на всей территории
                            <br>Республики Беларусь
                            </span>
                        `;
                        
        const elements = document.querySelectorAll('.tn-atom');
        elements.forEach(function (element) {
            if (element.textContent.includes('с 1 декабря')) {
                element.innerHTML = content;
            }
            if (element.textContent.includes('1010 человек уже')) {
                firstTotalPay = element;
            }
            if (element.textContent.includes('1011 человек уже')) {
                secondTotalPay = element;
            }
            if (element.textContent.includes('Осталось 25 штук по акции')) {
                firstGoodsCountElement = element;
            }
            if (element.textContent.includes('Осталось 24 штук по акции')) {
                secondGoodsCountElement = element;
            }
        });
    }

    function getDateStr(daysAgo) {
        const months = [
            'января',
            'февраля',
            'марта',
            'апреля',
            'мая',
            'июня',
            'июля',
            'августа',
            'сентября',
            'октября',
            'ноября',
            'декабря',
        ];
        const _newDate = new Date();
        const newDate = `${_newDate.getDate()} ${months[_newDate.getMonth()]}`;

        const _oldDate = new Date(
            _newDate.getTime() - daysAgo * 24 * 60 * 60 * 1000
        );
        const oldDate = `${_oldDate.getDate()} ${months[_oldDate.getMonth()]}`;

        return { new: newDate, old: oldDate };
    }

    function setGoodsCount() {
        const goodsCounter = parseInt(getCookie('goodsCounter'));
        goodsCounter ? setCount(goodsCounter) : setCount(25);
    }

    function setCount(goodsCounter) {
        const content = `
                            <span style="font-size: 16px; font-weight: 700;">
                            Осталось <span style="font-size: 18px; background-color: lightblue;
                            padding: 2px; border-radius: 5px;">
                            ${goodsCounter}</span> штук по акции
                            </span>
                        `;
        firstGoodsCountElement.innerHTML = content;
        secondGoodsCountElement.innerHTML = content;

        setTimeout(() => {
            if (goodsCounter > 2) {
                goodsCounter -= 1;
                setCookie('goodsCounter', goodsCounter, 5 * 24 * 60);
                setCount(goodsCounter);
            }
        }, Math.floor(Math.random() * 7000) + 3000);
    }

    function setTotalPay() {
        const totalPay = parseInt(getCookie('totalPay'));
        totalPay
            ? setTotal(totalPay)
            : setTotal(Math.floor(Math.random() * 500) + 900);
    }

    function setTotal(totalCounter) {
        totalCounter += Math.floor(Math.random() * 5) + 1;
        const content = `
                            <span style="font-size: 13px; font-weight: 700; color: #cb49f9;">
                            ${totalCounter} человек уже купили на этой неделе
                            </span>
                        `;
        firstTotalPay.innerHTML = content;
        secondTotalPay.innerHTML = content;
        setCookie('totalPay', totalCounter, 5 * 24 * 60);

        setTimeout(() => {
            setTotal(totalCounter);
        }, Math.floor(Math.random() * 5000) + 2000);
    }
</script>

<script>
    // Функция для уменьшения числа и записи его в блок
    function decreaseCount() {
        let lastPackElement = document.querySelector('.lastpack');
        let count = parseInt(lastPackElement.textContent);

        // Проверяем, если число больше 2, то уменьшаем его на 1 и обновляем блок
        if (count > 2) {
            count--;
            lastPackElement.textContent = count;
            document.cookie = 'lastPackCount=' + count;
        }
    }

    // Функция для случайного уменьшения числа через случайное время от 5 до 25 секунд
    function randomDecrease() {
        setTimeout(function () {
            decreaseCount();
            randomDecrease();
        }, Math.floor(Math.random() * 20000) + 5000); // От 5000 до 25000 миллисекунд
    }

    // Проверяем, есть ли сохраненное значение числа в куки
    let cookies = document.cookie.split(';');
    let savedCount = null;
    for (let cookie of cookies) {
        let parts = cookie.split('=');
        if (parts[0].trim() === 'lastPackCount') {
            savedCount = parseInt(parts[1]);
            break;
        }
    }
    if (savedCount !== null && !isNaN(savedCount)) {
        document.querySelector('.lastpack').textContent = savedCount;
    }

    // Запускаем случайное уменьшение числа
    randomDecrease();
</script>

<!-- ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////// -->

<style>
    .lastpack2 {
        font-size: 18px;
        font-weight: bold;
        color: #000000;
        background-color: lightblue; /* Цвет фона */
        padding: 2px; /* Отступы вокруг текста */
        border-radius: 5px; /* Скругление углов */
    }
</style>

<div>
    <div class="act">
        Акция действует <br />
        с <span class="by"></span> по <span class="to"></span> на всей <br />
        территории Республики Беларусь
    </div>
</div>

<div>
    <div class="act">
        Осталось <b class="lastpack2">12</b>&nbsp;штук по акции
    </div>
</div>

<script>
    (function setDate() {
        let d = new Date();
        let p = new Date(d.getTime() - 2 * 86400000);
        let monthA = [
            'января',
            'февраля',
            'марта',
            'апреля',
            'мая',
            'июня',
            'июля',
            'августа',
            'сентября',
            'октября',
            'ноября',
            'декабря',
        ];
        $('.by').html(p.getDate() + ' ' + monthA[p.getMonth()] + ' ');
        p = new Date(d.getTime() + 0 * 86400000);
        $('.to').html(
            p.getDate() +
                ' ' +
                monthA[p.getMonth()] +
                ' ' +
                p.getFullYear() +
                ' года'
        );
    })();
</script>

<script>
    // Функция для уменьшения числа и записи его в блок
    function decreaseCount_() {
        let lastPackElement = document.querySelector('.lastpack2');

        let cookies = document.cookie.split(';');
        let savedCount = null;
        for (let cookie of cookies) {
            let parts = cookie.split('=');
            if (parts[0].trim() === 'lastPackCount') {
                savedCount = parseInt(parts[1]);
                break;
            }
        }

        lastPackElement.textContent = savedCount ? savedCount : 2;
    }

    // Функция для случайного уменьшения числа через случайное время от 5 до 25 секунд
    function randomDecrease_() {
        setTimeout(function () {
            decreaseCount_();
            randomDecrease_();
        }, 2000); // От 5000 до 25000 миллисекунд
    }

    // Запускаем случайное уменьшение числа
    randomDecrease_();
</script>
